
-- 1: Report the min and max of AQI value for each State during each quarter of years.
SELECT 
    {[Measures].[Min Aqi Value], [Measures].[Max Aqi Value]} ON COLUMNS,
    NONEMPTY(
        ORDER(
            CROSSJOIN(
                [DIM COUNTY].[State Name].Members,
                CROSSJOIN(
                    [DIM DATE].[Hierarchy].[Year].Members,
                    [DIM DATE].[Quarter].[Quarter].Members
                )
            ),
            [DIM COUNTY].[State Name].CurrentMember.Name,
			ASC
        ),
        {[Measures].[Min Aqi Value], [Measures].[Max Aqi Value]}
    ) ON ROWS
FROM 
    [US AQI DDS];


/* 2: Report the mean and the standard deviation of AQI value for each State during
each quarter of years. Analysis hints: How do the AQI values fluctuate during the
year? Pay attention to the values (mean, std, max, min). Are any unusually large or
small? 
*/
WITH
    -- Calculate Mean AQI
    MEMBER [Measures].[Mean AQI] AS
        AVG(
            EXISTING [DIM COUNTY].[State Name].[State Name].Members * 
            [DIM DATE].[Year].[Year].Members * 
            [DIM DATE].[Quarter].[Quarter].Members, 
            [Measures].[Aqi Value]
        )

    -- Calculate Standard Deviation of AQI (only if more than 1 value exists)
    MEMBER [Measures].[Std Dev AQI] AS
        IIF(
            COUNT(
                EXISTING [DIM COUNTY].[State Name].[State Name].Members * 
                [DIM DATE].[Year].[Year].Members * 
                [DIM DATE].[Quarter].[Quarter].Members
            ) > 1,
            STDDEV(
                EXISTING [DIM COUNTY].[State Name].[State Name].Members * 
                [DIM DATE].[Year].[Year].Members * 
                [DIM DATE].[Quarter].[Quarter].Members, 
                [Measures].[Aqi Value]
            ),
            NULL
        )

    -- Calculate Min AQI
    MEMBER [Measures].[Min AQI] AS
        MIN(
            EXISTING [DIM COUNTY].[State Name].[State Name].Members * 
            [DIM DATE].[Year].[Year].Members * 
            [DIM DATE].[Quarter].[Quarter].Members, 
            [Measures].[Aqi Value]
        )

    -- Calculate Max AQI
    MEMBER [Measures].[Max AQI] AS
        MAX(
            EXISTING [DIM COUNTY].[State Name].[State Name].Members * 
            [DIM DATE].[Year].[Year].Members * 
            [DIM DATE].[Quarter].[Quarter].Members, 
            [Measures].[Aqi Value]
        )

SELECT
    {[Measures].[Mean AQI], [Measures].[Std Dev AQI], [Measures].[Min AQI], [Measures].[Max AQI]} ON COLUMNS,
    NONEMPTY(
        CROSSJOIN(
            [DIM COUNTY].[State Name].[State Name].Members,
            CROSSJOIN(
                [DIM DATE].[Year].[Year].Members,
                [DIM DATE].[Quarter].[Quarter].Members
            )
        )
    ) ON ROWS
FROM 
    [US AQI DDS];

-- 3:


-- 4: 

WITH 
MEMBER [Measures].[Number of Reports Adjusted] AS
    COALESCEEMPTY([Measures].[Number of Reports], 0)
SELECT 
    NON EMPTY { [Measures].[Number of Reports Adjusted] } ON COLUMNS, 
    { ([DIM COUNTY].[State Name].[State Name].ALLMEMBERS * 
       [DIM CATEGORY].[Level Of Concern].[Level Of Concern].ALLMEMBERS) } 
    DIMENSION PROPERTIES MEMBER_CAPTION, MEMBER_UNIQUE_NAME ON ROWS 
FROM 
    ( SELECT 
        ( { [DIM COUNTY].[State Name].&[Alaska], 
            [DIM COUNTY].[State Name].&[Illinois], 
            [DIM COUNTY].[State Name].&[Hawaii], 
            [DIM COUNTY].[State Name].&[Delaware] } ) ON COLUMNS 
      FROM [US AQI DDS]) 
CELL PROPERTIES VALUE, BACK_COLOR, FORE_COLOR, FORMATTED_VALUE, FORMAT_STRING, FONT_NAME, FONT_SIZE, FONT_FLAGS


-- 5: 
//WITH 
//MEMBER [Measures].[Mean AQI] AS
//    AVG(
//        [DIM DATE].[Quarter].[Quarter].MEMBERS, -- This assumes a hierarchy with Quarter levels in the Date dimension
//        [Measures].[AQI Value] -- Measure containing the AQI values
//    )
SELECT 
    {[DIM COUNTY].[State Name].&[Hawaii],
     [DIM COUNTY].[State Name].&[Alaska],
     [DIM COUNTY].[State Name].&[Illinois],
     [DIM COUNTY].[State Name].&[Delaware]} ON ROWS, 
    [DIM DATE].[Quarter].[Quarter].MEMBERS ON COLUMNS
FROM [US AQI DDS]
WHERE ([Measures].[AQI Value]);

-- 6: 